# 第一阶段：基础查询练习

## 练习说明
- 所有查询都在 `study_db` 数据库中执行
- 建议先自己完成，再查看参考答案
- 注意观察查询结果，理解SQL语义

---

## 1. SELECT 基础查询

### 1.1 查询所有用户信息
```sql
-- 查询users表的所有字段和所有记录
-- 思考：如何限制只查看前10条？

select * from users limit 10;

mysql> select * from users limit 10;
+----+----------+--------------------+----------------------------------+-------------+--------+--------+---------------------+---------------------+
| id | username | email              | password_hash                    | phone       | avatar | status | created_at          | updated_at          |
+----+----------+--------------------+----------------------------------+-------------+--------+--------+---------------------+---------------------+
|  1 | user1    | user1@example.com  | 7c6a180b36896a0a8c02787eeafb0e4c | 13808338962 | NULL   |      1 | 2025-02-02 07:34:33 | 2025-10-04 07:34:33 |
|  2 | user2    | user2@example.com  | 6cb75f652a9b52798eb6cf2201057c73 | 13086452959 | NULL   |      1 | 2024-11-19 07:34:33 | 2025-10-04 07:34:33 |
|  3 | user3    | user3@example.com  | 819b0643d6b89dc9b579fdfc9094f28e | 13091086350 | NULL   |      1 | 2024-11-14 07:34:33 | 2025-10-04 07:34:33 |
|  4 | user4    | user4@example.com  | 34cc93ece0ba9e3f6f235d4af979b16c | 13952679737 | NULL   |      0 | 2025-02-25 07:34:33 | 2025-10-04 07:34:33 |
|  5 | user5    | user5@example.com  | db0edd04aaac4506f7edab03ac855d56 | 13755049129 | NULL   |      1 | 2025-04-02 07:34:33 | 2025-10-04 07:34:33 |
|  6 | user6    | user6@example.com  | 218dd27aebeccecae69ad8408d9a36bf | 13681579065 | NULL   |      1 | 2025-05-28 07:34:33 | 2025-10-04 07:34:33 |
|  7 | user7    | user7@example.com  | 00cdb7bb942cf6b290ceb97d6aca64a3 | 13140000312 | NULL   |      1 | 2025-01-08 07:34:33 | 2025-10-04 07:34:33 |
|  8 | user8    | user8@example.com  | b25ef06be3b6948c0bc431da46c2c738 | 13797391854 | NULL   |      1 | 2025-04-18 07:34:33 | 2025-10-04 07:34:33 |
|  9 | user9    | user9@example.com  | 5d69dd95ac183c9643780ed7027d128a | 13011341552 | NULL   |      1 | 2025-06-27 07:34:33 | 2025-10-04 07:34:33 |
| 10 | user10   | user10@example.com | 87e897e3b54a405da144968b2ca19b45 | 13377745694 | NULL   |      0 | 2025-07-14 07:34:33 | 2025-10-04 07:34:33 |
+----+
```

### 1.2 查询指定列
```sql
-- 只查询用户的 id, username, email 三个字段
-- 显示前20条记录


select id,username,email from users limit 0,20;

mysql> select id,username,email from users limit 0,20;
+----+----------+--------------------+
| id | username | email              |
+----+----------+--------------------+
|  1 | user1    | user1@example.com  |
|  2 | user2    | user2@example.com  |
|  3 | user3    | user3@example.com  |
|  4 | user4    | user4@example.com  |
|  5 | user5    | user5@example.com  |
|  6 | user6    | user6@example.com  |
|  7 | user7    | user7@example.com  |
|  8 | user8    | user8@example.com  |
|  9 | user9    | user9@example.com  |
| 10 | user10   | user10@example.com |
| 11 | user11   | user11@example.com |
| 12 | user12   | user12@example.com |
| 13 | user13   | user13@example.com |
| 14 | user14   | user14@example.com |
| 15 | user15   | user15@example.com |
| 16 | user16   | user16@example.com |
| 17 | user17   | user17@example.com |
| 18 | user18   | user18@example.com |
| 19 | user19   | user19@example.com |
| 20 | user20   | user20@example.com |
+----+----------+--------------------+
```

### 1.3 使用别名
```sql
-- 查询商品信息，将字段名改为中文显示
-- id -> 商品编号, name -> 商品名称, price -> 售价


-- 我的mysql终端无法输入中文，所以就用英文好了
-- as可以省略
mysql> select id as product_id, name as product_name, price from products limit 5;
+------------+---------------------+--------+
| product_id | product_name        | price  |
+------------+---------------------+--------+
|          1 | 商品1 - 热销款      | 262.00 |
|          2 | 商品2 - 热销款      | 492.00 |
|          3 | 商品3 - 特惠款      | 317.00 |
|          4 | 商品4 - 限量版      |  28.00 |
|          5 | 商品5 - 特惠款      | 846.00 |
+------------+---------------------+--------+
5 rows in set (0.00 sec)
```

---

## 2. WHERE 条件过滤

### 2.1 等值查询
```sql
-- 查询状态为"正常"(status=1)的用户
-- 显示用户名、邮箱、手机号

mysql> select username, email ,phone from users where status = 1 limit 1;
+----------+-------------------+-------------+
| username | email             | phone       |
+----------+-------------------+-------------+
| user1    | user1@example.com | 13808338962 |
+----------+-------------------+-------------+
1 row in set (0.00 sec)
```

### 2.2 比较运算符
```sql
-- 查询价格大于500元的商品
-- 显示商品名称、价格、库存

mysql> select name, price ,stock  from products where price > 500 limit 10;
+-----------------------+--------+-------+
| name                  | price  | stock |
+-----------------------+--------+-------+
| 商品298 - 特惠款      | 503.00 |   149 |
| 商品102 - 特惠款      | 504.00 |   596 |
| 商品188 - 经典款      | 509.00 |   631 |
| 商品306 - 限量版      | 512.00 |   309 |
| 商品303 - 限量版      | 514.00 |   204 |
| 商品470 - 限量版      | 518.00 |   653 |
| 商品87 - 热销款       | 521.00 |   123 |
| 商品16 - 特惠款       | 522.00 |   756 |
| 商品364 - 特惠款      | 524.00 |   365 |
| 商品66 - 新品         | 526.00 |   192 |
+-----------------------+--------+-------+
10 rows in set (0.00 sec)
```

### 2.3 范围查询
```sql
-- 查询价格在100-500元之间的商品（包含100和500）
-- 使用 BETWEEN...AND

mysql> select name, price ,stock  from products where price between 100 and 500  limit 10;
+-----------------------+--------+-------+
| name                  | price  | stock |
+-----------------------+--------+-------+
| 商品234 - 新品        | 100.00 |   114 |
| 商品86 - 特惠款       | 101.00 |   805 |
| 商品318 - 热销款      | 101.00 |   133 |
| 商品333 - 经典款      | 101.00 |   821 |
| 商品42 - 经典款       | 103.00 |   345 |
| 商品454 - 新品        | 103.00 |   845 |
| 商品98 - 特惠款       | 107.00 |   138 |
| 商品158 - 经典款      | 109.00 |   581 |
| 商品173 - 新品        | 111.00 |   322 |
| 商品464 - 特惠款      | 111.00 |   445 |
+-----------------------+--------+-------+
10 rows in set (0.00 sec)
```

### 2.4 IN 查询
```sql
-- 查询订单状态为"已支付"(1)或"已发货"(2)的订单
-- 显示订单号、用户ID、订单状态、订单金额

mysql> select order_no, user_id, status, total_amount from orders where status in (1,2) limit 5;
-- 或者用or
mysql> select order_no, user_id, status, total_amount from orders where (status = 1 or status = 2) limit 5;

对比执行计划，都是一样的：
1. IN
mysql> explain select order_no, user_id, status, total_amount from orders where status in (1,2) limit 5;
+----+-------------+--------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
| id | select_type | table  | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+--------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | orders | NULL       | range | idx_status    | idx_status | 1       | NULL | 7962 |   100.00 | Using index condition |
+----+-------------+--------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
1 row in set, 1 warning (0.00 sec)

2. OR
mysql> explain select order_no, user_id, status, total_amount from orders where (status = 1 or status = 2) limit 5;
+----+-------------+--------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
| id | select_type | table  | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra                 |
+----+-------------+--------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
|  1 | SIMPLE      | orders | NULL       | range | idx_status    | idx_status | 1       | NULL | 7962 |   100.00 | Using index condition |
+----+-------------+--------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
1 row in set, 1 warning (0.01 sec)
```

### 2.5 模糊查询
```sql
-- 查询商品名称中包含"经典款"的所有商品
-- 使用 LIKE 关键字

select * from products where name like '%经典款%';

查询计划，没有走索引：
mysql> explain select * from products where name like '%经典款%';
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | products | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  500 |    11.11 | Using where |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

改成左匹配查询
mysql> explain select * from products where name like '经典款%';
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | SIMPLE      | products | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  500 |    11.11 | Using where |
+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

也没有走索引，因为name字段上没有索引哈哈：
mysql> SHOW INDEX FROM products;
+----------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table    | Non_unique | Key_name        | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+----------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| products |          0 | PRIMARY         |            1 | id          | A         |         500 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| products |          1 | idx_category_id |            1 | category_id | A         |          45 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| products |          1 | idx_status      |            1 | status      | A         |           2 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| products |          1 | idx_price       |            1 | price       | A         |         387 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| products |          1 | idx_sales       |            1 | sales       | A         |         492 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+----------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
5 rows in set (0.01 sec)

也可以用SHOW KEYS FROM products;查看表上面有没有索引

```

### 2.6 NULL 值查询
```sql
-- 查询没有填写手机号的用户（phone 为 NULL）
-- 显示用户名和邮箱

select username, email from users where phone is null;

-- 或者 select username, email from users where phone is null;

-- 查看手机号不为空 select username, email from users where phone is not null;

-- 或者 select username, email from users where phone != null;

```

---

## 3. 逻辑运算符

### 3.1 AND 多条件
```sql
-- 查询状态为正常，且价格大于1000的商品
-- 显示商品名称、价格、库存、状态

select name, price, stock, status from products where status = 1 and price > 1000;
```

### 3.2 OR 或条件
```sql
-- 查询库存小于10 或 销量大于5000的商品
-- 显示商品名称、库存、销量

select name, stock, sales from products where stock < 10 or sales > 5000;
```

### 3.3 NOT 否定
```sql
-- 查询状态不是"待支付"(0)的订单
-- 显示订单号、状态、订单金额

select * from orders where status != 0;

-- 或者 select * from orders where status <> 0;

```

### 3.4 复合条件
```sql
-- 查询符合以下条件的商品：
-- (价格<100 或 价格>1000) 并且 库存>50

select count(1) from products where (price < 100 or price > 1000) and stock > 50;
```

---

## 4. ORDER BY 排序

### 4.1 单字段升序
```sql
-- 查询所有商品，按价格从低到高排序
-- 显示商品名称、价格

select name, price from products order by price;

-- 默认就是升序 也可以显式指定  select name, price from products order by price asc;
```

### 4.2 单字段降序
```sql
-- 查询所有商品，按销量从高到低排序
-- 显示商品名称、销量、价格
-- 只显示前10名


mysql> select name, sales, price from products order by sales desc limit 10;
+-----------------------+-------+--------+
| name                  | sales | price  |
+-----------------------+-------+--------+
| 商品193 - 限量版      |  9997 |  87.00 |
| 商品214 - 热销款      |  9986 | 293.00 |
| 商品20 - 限量版       |  9981 |  67.00 |
| 商品88 - 新品         |  9965 | 589.00 |
| 商品7 - 热销款        |  9936 | 211.00 |
| 商品66 - 新品         |  9934 | 526.00 |
| 商品81 - 特惠款       |  9894 | 647.00 |
| 商品95 - 新品         |  9892 | 563.00 |
| 商品190 - 限量版      |  9891 | 786.00 |
| 商品448 - 限量版      |  9887 | 752.00 |
+-----------------------+-------+--------+
10 rows in set (0.01 sec)
```

### 4.3 多字段排序
```sql
-- 查询所有订单，先按状态升序，再按创建时间降序
-- 显示订单号、状态、订单金额、创建时间

mysql> select order_no, status, total_amount, created_at from orders order by status asc, created_at desc limit 10;
+---------------------+--------+--------------+---------------------+
| order_no            | status | total_amount | created_at          |
+---------------------+--------+--------------+---------------------+
| ORD2025100400019735 |      0 |      1208.00 | 2025-10-04 07:35:01 |
| ORD2025100400018761 |      0 |      1047.00 | 2025-10-04 07:35:01 |
| ORD2025100400018025 |      0 |       929.00 | 2025-10-04 07:35:00 |
| ORD2025100400013843 |      0 |      1866.00 | 2025-10-04 07:34:56 |
| ORD2025100400014083 |      0 |      1749.00 | 2025-10-04 07:34:56 |
| ORD2025100400012943 |      0 |      1961.00 | 2025-10-04 07:34:55 |
| ORD2025100400012094 |      0 |      1355.00 | 2025-10-04 07:34:54 |
| ORD2025100400011547 |      0 |      1191.00 | 2025-10-04 07:34:53 |
| ORD2025100400008105 |      0 |       864.00 | 2025-10-04 07:34:50 |
| ORD2025100400007293 |      0 |      1046.00 | 2025-10-04 07:34:49 |
+---------------------+--------+--------------+---------------------+
10 rows in set (0.01 sec)
```

---

## 5. LIMIT 分页

### 5.1 限制记录数
```sql
-- 查询最新注册的20个用户
-- 按注册时间降序排列

mysql> select * from users order by created_at desc limit 20;
+-----+----------+---------------------+----------------------------------+-------------+--------+--------+---------------------+---------------------+
| id  | username | email               | password_hash                    | phone       | avatar | status | created_at          | updated_at          |
+-----+----------+---------------------+----------------------------------+-------------+--------+--------+---------------------+---------------------+
| 101 | user101  | user101@example.com | 2804df10cfd85d566a0fbb8d71f760b0 | 13084832570 | NULL   |      0 | 2025-10-04 07:34:33 | 2025-10-04 07:34:33 |
| 147 | user147  | user147@example.com | 19e82dd6edde3bdcc3081b4babb3e3be | 13799548821 | NULL   |      1 | 2025-10-04 07:34:33 | 2025-10-04 07:34:33 |
| 676 | user676  | user676@example.com | fcef74eeb2c6f2519651554829eaaee9 | 13410582538 | NULL   |      1 | 2025-10-03 07:34:33 | 2025-10-04 07:34:33 |
| 912 | user912  | user912@example.com | e6c04eb03e10a4e3121475a717b817f0 | 13642302707 | NULL   |      1 | 2025-10-03 07:34:33 | 2025-10-04 07:34:33 |
| 489 | user489  | user489@example.com | 04f27a0eeacac2e26752a2ecf4dfdbf5 | 13364324718 | NULL   |      1 | 2025-10-03 07:34:33 | 2025-10-04 07:34:33 |
|  65 | user65   | user65@example.com  | 3cc973d22efb4e39c7aabc036cec11f8 | 13328340160 | NULL   |      1 | 2025-10-02 07:34:33 | 2025-10-04 07:34:33 |
| 740 | user740  | user740@example.com | 4fed019d307b7f8aee556b00c6dfb386 | 13097414560 | NULL   |      0 | 2025-10-02 07:34:33 | 2025-10-04 07:34:33 |
| 780 | user780  | user780@example.com | b7e9b6ce667487531fe6fbd123f20d60 | 13017569749 | NULL   |      1 | 2025-10-02 07:34:33 | 2025-10-04 07:34:33 |
| 713 | user713  | user713@example.com | 804bde3b2fdf8d8a9a2e089e8ad9d7e7 | 13926979934 | NULL   |      1 | 2025-10-01 07:34:33 | 2025-10-04 07:34:33 |
| 523 | user523  | user523@example.com | 7ffb04c0a0b971b35892de1c700d97fa | 13235198071 | NULL   |      1 | 2025-10-01 07:34:33 | 2025-10-04 07:34:33 |
| 985 | user985  | user985@example.com | 4c4e922f752ab8b81da65f2a848b5d50 | 13878118845 | NULL   |      1 | 2025-10-01 07:34:33 | 2025-10-04 07:34:33 |
| 241 | user241  | user241@example.com | c3cf464075ee0cb18a985d00fbb8b79e | 13612473350 | NULL   |      1 | 2025-10-01 07:34:33 | 2025-10-04 07:34:33 |
| 497 | user497  | user497@example.com | 806a44debdb6c6ca02bcc7870cc619bb | 13682513103 | NULL   |      0 | 2025-09-30 07:34:33 | 2025-10-04 07:34:33 |
|  66 | user66   | user66@example.com  | f8f2c7990ce3701e3fb7562ac4994fb1 | 13642048836 | NULL   |      1 | 2025-09-30 07:34:33 | 2025-10-04 07:34:33 |
| 317 | user317  | user317@example.com | 3ec7e5356a5942787e7899a65038e51c | 13804214557 | NULL   |      0 | 2025-09-30 07:34:33 | 2025-10-04 07:34:33 |
| 127 | user127  | user127@example.com | e14a0780847cc66e269920ae677b671d | 13586148374 | NULL   |      1 | 2025-09-29 07:34:33 | 2025-10-04 07:34:33 |
| 674 | user674  | user674@example.com | 8103139345de054f41a102cf8bf605a2 | 13373578665 | NULL   |      1 | 2025-09-28 07:34:33 | 2025-10-04 07:34:33 |
| 305 | user305  | user305@example.com | 7cdf9a8a78dc77f5dafbf7f13d69cef8 | 13079773446 | NULL   |      1 | 2025-09-28 07:34:33 | 2025-10-04 07:34:33 |
| 667 | user667  | user667@example.com | ffcf5efaecac099573995cb1fdb940d4 | 13096607049 | NULL   |      1 | 2025-09-28 07:34:33 | 2025-10-04 07:34:33 |
| 293 | user293  | user293@example.com | 5849d359c59048290c535783af5b98f9 | 13602329101 | NULL   |      1 | 2025-09-28 07:34:33 | 2025-10-04 07:34:33 |
+-----+----------+---------------------+----------------------------------+-------------+--------+--------+---------------------+---------------------+
20 rows in set (0.01 sec)
```

### 5.2 分页查询
```sql
-- 分页查询商品列表，每页显示50条
-- 查询第2页的数据（即第51-100条）

select id, name from products limit 50,50;

-- 或者 select id, name from products limit 50 offset 50;

```

### 5.3 TOP N 查询
```sql
-- 查询销量最高的5个商品
-- 显示商品名称、销量、价格

mysql> select name, sales, price from products order by sales desc limit 5;
+-----------------------+-------+--------+
| name                  | sales | price  |
+-----------------------+-------+--------+
| 商品193 - 限量版      |  9997 |  87.00 |
| 商品214 - 热销款      |  9986 | 293.00 |
| 商品20 - 限量版       |  9981 |  67.00 |
| 商品88 - 新品         |  9965 | 589.00 |
| 商品7 - 热销款        |  9936 | 211.00 |
+-----------------------+-------+--------+
5 rows in set (0.00 sec)
```

---

## 6. DISTINCT 去重

### 6.1 单字段去重
```sql
-- 查询所有用户所在的不同省份
-- 从 user_addresses 表查询

select distinct province from user_addresses;
```

### 6.2 多字段去重
```sql
-- 查询所有订单使用过的支付方式
-- 从 orders 表查询，去除 NULL 值

select distinct payment_method from orders WHERE payment_method IS NOT NULL;;
```

---

## 7. 聚合函数基础

### 7.1 COUNT 计数
```sql
-- 统计总共有多少个用户


select count(*) AS total_users from users;
```

### 7.2 SUM 求和
```sql
-- 统计所有已完成订单(status=3)的总金额

select sum(pay_amount) AS total_amount from orders where status = 3;
```

### 7.3 AVG 平均值
```sql
-- 计算所有商品的平均价格
-- 保留2位小数

mysql> select avg(price) from products;
+------------+
| avg(price) |
+------------+
| 514.326000 |
+------------+
1 row in set (0.01 sec)

-- 要保留两位小数
select round(avg(price),2) from products;

```

### 7.4 MAX/MIN 最值
```sql
-- 查询价格最高和最低的商品价格
-- 使用一条SQL完成

mysql> select max(price) max_price, min(price) from products;
+-----------+------------+
| max_price | min(price) |
+-----------+------------+
|    999.00 |      13.00 |
+-----------+------------+
1 row in set (0.00 sec)
```

---

## 8. 日期时间函数

### 8.1 日期格式化
```sql
-- 查询最近注册的10个用户
-- 将创建时间格式化为 'YYYY-MM-DD HH:mm:ss'

select username, date_format(created_at,'%Y年%m月%d日 %H时%i分%s秒') from users order by created_at desc limit 10;

```

### 8.2 日期计算
```sql
-- 查询最近30天内创建的订单数量
-- 使用 DATE_SUB 或 INTERVAL

-- 使用DATE_SUB
select DATE_SUB(NOW(), INTERVAL 30 DAY);

select INTERVAL 30 DAY

select count(*) from orders where created_at > DATE_SUB(NOW(), INTERVAL 30 DAY);


```

### 8.3 提取日期部分
```sql
-- 统计每个月的注册用户数
-- 提取年月，如 '2024-01'


-- 这样会报错：In aggregated query without GROUP BY
mysql> select count(*),created_at from users;
ERROR 1140 (42000): In aggregated query without GROUP BY, expression #2 of SELECT list contains nonaggregated column 'study_db.users.created_at'; this is incompatible with sql_mode=only_full_group_by

select date_format(created_at, '%y-%m') month, count(*) user_count 
from users
group by month
order by month desc;

 ```

---

## 9. 字符串函数

### 9.1 字符串拼接
```sql
-- 查询用户信息，将username和email拼接显示
-- 格式：'用户名 (邮箱)'

select concat(username,'（',email,'）') from users limit 5;
```

### 9.2 字符串截取
```sql
-- 查询所有用户的手机号，隐藏中间4位
-- 格式：138****1234

select concat(substring(phone,1,3),'****',substring(phone,8,4))
from users 
limit 5;
```

### 9.3 大小写转换
```sql
-- 将所有商品名称转换为大写显示

select upper(name) from products limit 10;
```

---

## 10. 综合练习

### 10.1 商品列表查询
```sql
-- 查询满足以下条件的商品：
-- 1. 状态为上架(status=1)
-- 2. 价格在50-500之间
-- 3. 库存大于0
-- 4. 按销量降序排列
-- 5. 只显示前20条
-- 显示：商品名称、价格、库存、销量


select name,price,stock,sales,status from products
where 
status = 1 
and (price between 50 and 500) 
and stock > 0 
order by sales desc
limit 20;
```

### 10.2 用户统计
```sql
-- 统计不同状态的用户数量
-- 显示：状态值、用户数量
-- 提示：这题需要用到 GROUP BY，可以尝试使用

select count(*),
status,
  CASE status
    WHEN 0 THEN '禁用'
    WHEN 1 THEN '正常'
    ELSE '未知'
    END as '状态'
from users
group by status
```

### 10.3 订单分析
```sql
-- 查询订单金额超过平均订单金额的订单
-- 显示订单号、订单金额、创建时间
-- 按订单金额降序排列
-- 提示：需要使用子查询

-- 使用聚合函数：语法错误
select avg(pay_amount) avg_pay_amount, order_no, pay_amount, created_at
from orders
where pay_amount > avg(pay_amount) 
order by pay_amount desc;

-- 使用聚合函数：having，必须配合group by使用
-- ERROR 1140 (42000): In aggregated query without GROUP BY, expression #2 of SELECT list contains nonaggregated column 'study_db.orders.order_no'; this is incompatible with sql_mode=only_full_group_by
-- sql_mode=only_full_group_by模式下不兼容
select avg(pay_amount) avg_pay_amount, order_no, pay_amount, created_at
from orders
having pay_amount > avg(pay_amount) 
order by pay_amount desc;

-- 这个场景只能使用子查询了
select order_no, pay_amount, created_at
from orders
where pay_amount > (select avg(pay_amount) from orders)
order by pay_amount desc;

```

---

## 学习检查点

完成所有练习后，你应该能够：
- [ ] 熟练编写 SELECT 查询语句
- [ ] 使用各种 WHERE 条件过滤数据
- [ ] 掌握 ORDER BY 和 LIMIT 分页
- [ ] 理解 DISTINCT 去重原理
- [ ] 使用常见的聚合函数
- [ ] 处理日期时间和字符串
- [ ] 组合多个条件编写复杂查询

**下一步**: 完成后查看 `solutions/01-基础查询.md` 对照答案，然后进入第二阶段学习。
