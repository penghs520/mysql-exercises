# 第一阶段：基础查询答案

## 1. SELECT 基础查询

### 1.1 查询所有用户信息
```sql
-- 查询所有字段和记录
SELECT * FROM users;

-- 只查看前10条
SELECT * FROM users LIMIT 10;
```

### 1.2 查询指定列
```sql
SELECT id, username, email
FROM users
LIMIT 20;
```

### 1.3 使用别名
```sql
SELECT
  id AS 商品编号,
  name AS 商品名称,
  price AS 售价
FROM products
LIMIT 20;
```

---

## 2. WHERE 条件过滤

### 2.1 等值查询
```sql
SELECT username, email, phone
FROM users
WHERE status = 1;
```

### 2.2 比较运算符
```sql
SELECT name, price, stock
FROM products
WHERE price > 500;
```

### 2.3 范围查询
```sql
SELECT name, price, stock
FROM products
WHERE price BETWEEN 100 AND 500;
```

### 2.4 IN 查询
```sql
SELECT order_no, user_id, status, pay_amount
FROM orders
WHERE status IN (1, 2);
```

### 2.5 模糊查询
```sql
SELECT name, price
FROM products
WHERE name LIKE '%经典款%';
```

### 2.6 NULL 值查询
```sql
SELECT username, email
FROM users
WHERE phone IS NULL;
```

---

## 3. 逻辑运算符

### 3.1 AND 多条件
```sql
SELECT name, price, stock, status
FROM products
WHERE status = 1 AND price > 1000;
```

### 3.2 OR 或条件
```sql
SELECT name, stock, sales
FROM products
WHERE stock < 10 OR sales > 5000;
```

### 3.3 NOT 否定
```sql
SELECT order_no, status, pay_amount
FROM orders
WHERE status != 0;
-- 或
WHERE status <> 0;
-- 或
WHERE NOT status = 0;
```

### 3.4 复合条件
```sql
SELECT name, price, stock
FROM products
WHERE (price < 100 OR price > 1000) AND stock > 50;
```

---

## 4. ORDER BY 排序

### 4.1 单字段升序
```sql
SELECT name, price
FROM products
ORDER BY price ASC;
-- 或省略ASC（默认升序）
ORDER BY price;
```

### 4.2 单字段降序
```sql
SELECT name, sales, price
FROM products
ORDER BY sales DESC
LIMIT 10;
```

### 4.3 多字段排序
```sql
SELECT order_no, status, pay_amount, created_at
FROM orders
ORDER BY status ASC, created_at DESC;
```

---

## 5. LIMIT 分页

### 5.1 限制记录数
```sql
SELECT username, email, created_at
FROM users
ORDER BY created_at DESC
LIMIT 20;
```

### 5.2 分页查询
```sql
-- 第2页，每页50条
SELECT id, name, price, stock
FROM products
LIMIT 50, 50;
-- 或使用OFFSET
LIMIT 50 OFFSET 50;
```

### 5.3 TOP N 查询
```sql
SELECT name, sales, price
FROM products
ORDER BY sales DESC
LIMIT 5;
```

---

## 6. DISTINCT 去重

### 6.1 单字段去重
```sql
SELECT DISTINCT province
FROM user_addresses
ORDER BY province;
```

### 6.2 多字段去重
```sql
SELECT DISTINCT payment_method
FROM orders
WHERE payment_method IS NOT NULL;
```

---

## 7. 聚合函数基础

### 7.1 COUNT 计数
```sql
SELECT COUNT(*) AS total_users
FROM users;
```

### 7.2 SUM 求和
```sql
SELECT SUM(pay_amount) AS total_amount
FROM orders
WHERE status = 3;
```

### 7.3 AVG 平均值
```sql
SELECT ROUND(AVG(price), 2) AS avg_price
FROM products;
```

### 7.4 MAX/MIN 最值
```sql
SELECT
  MAX(price) AS max_price,
  MIN(price) AS min_price
FROM products;
```

---

## 8. 日期时间函数

### 8.1 日期格式化
```sql
SELECT
  username,
  email,
  DATE_FORMAT(created_at, '%Y-%m-%d %H:%i:%s') AS register_time
FROM users
ORDER BY created_at DESC
LIMIT 10;
```

### 8.2 日期计算
```sql
SELECT COUNT(*) AS recent_orders
FROM orders
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY);
```

### 8.3 提取日期部分
```sql
SELECT
  DATE_FORMAT(created_at, '%Y-%m') AS month,
  COUNT(*) AS user_count
FROM users
GROUP BY DATE_FORMAT(created_at, '%Y-%m')
ORDER BY month DESC;
```

---

## 9. 字符串函数

### 9.1 字符串拼接
```sql
SELECT CONCAT(username, ' (', email, ')') AS user_info
FROM users
LIMIT 10;
```

### 9.2 字符串截取
```sql
SELECT
  username,
  CONCAT(
    SUBSTRING(phone, 1, 3),
    '****',
    SUBSTRING(phone, 8, 4)
  ) AS masked_phone
FROM users
WHERE phone IS NOT NULL
LIMIT 10;
```

### 9.3 大小写转换
```sql
SELECT
  UPPER(name) AS uppercase_name,
  LOWER(name) AS lowercase_name
FROM products
LIMIT 10;
```

---

## 10. 综合练习

### 10.1 商品列表查询
```sql
SELECT name, price, stock, sales
FROM products
WHERE status = 1
  AND price BETWEEN 50 AND 500
  AND stock > 0
ORDER BY sales DESC
LIMIT 20;
```

### 10.2 用户统计
```sql
SELECT
  status,
  CASE status
    WHEN 0 THEN '禁用'
    WHEN 1 THEN '正常'
    ELSE '未知'
  END AS status_name,
  COUNT(*) AS user_count
FROM users
GROUP BY status;
```

### 10.3 订单分析
```sql
SELECT order_no, pay_amount, created_at
FROM orders
WHERE pay_amount > (SELECT AVG(pay_amount) FROM orders)
ORDER BY pay_amount DESC;
```

---

## 学习要点总结

1. **SELECT语法顺序**：
   ```
   SELECT 字段
   FROM 表
   WHERE 条件
   GROUP BY 分组
   HAVING 分组条件
   ORDER BY 排序
   LIMIT 分页
   ```

2. **WHERE vs HAVING**：
   - WHERE：过滤行，在分组前
   - HAVING：过滤组，在分组后

3. **性能提示**：
   - 避免 SELECT *，只查询需要的字段
   - 利用索引字段做查询条件
   - LIKE '%keyword' 无法使用索引
   - 尽量避免在WHERE中对字段使用函数

4. **常见陷阱**：
   - NULL 要用 IS NULL，不能用 = NULL
   - 字符串比较区分大小写（取决于排序规则）
   - DATE类型比较要注意时间部分

继续练习第二阶段！
